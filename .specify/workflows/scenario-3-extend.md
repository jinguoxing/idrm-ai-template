# åœºæ™¯ä¸‰ï¼šå·²æœ‰åŠŸèƒ½æ‰©å±• - å¢é‡å¼€å‘å·¥ä½œæµ

> **Version**: 1.0.0  
> **Created**: 2026-01-02  
> **Scenario**: Feature Extension

---

## æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº†**åœ¨å·²æœ‰åŠŸèƒ½åŸºç¡€ä¸Šè¿›è¡Œæ‰©å±•**çš„å¢é‡å¼€å‘å·¥ä½œæµã€‚é€‚ç”¨äºï¼š

- åœ¨ç°æœ‰åŠŸèƒ½ä¸Šæ·»åŠ å­åŠŸèƒ½
- æ‰©å±• API æ¥å£
- æ·»åŠ æ–°çš„æ•°æ®å­—æ®µ
- åŠŸèƒ½å¢å¼º

---

## é€‚ç”¨æ¡ä»¶

ä½¿ç”¨æ­¤å·¥ä½œæµçš„åˆ¤æ–­æ ‡å‡†ï¼š

| æ¡ä»¶ | çŠ¶æ€ |
|------|------|
| `specs/{feature}/` ç›®å½• | âœ… å­˜åœ¨ |
| å·²æœ‰ spec.md | âœ… å­˜åœ¨ |
| å˜æ›´è§„æ¨¡ | â• ä¸­ç­‰ï¼ˆæ‰©å±•ï¼‰ |
| æ˜¯å¦æ¶‰åŠæ–°éœ€æ±‚ | âœ… æ˜¯ï¼ˆæ–°å¢ï¼‰ |
| æ˜¯å¦æ¶‰åŠæ¶æ„å˜æ›´ | âŒ å¦ï¼ˆä¿æŒç°æœ‰æ¶æ„ï¼‰ |

---

## å·¥ä½œæµæ€»è§ˆ

```
Step 1: åˆ†ææ‰©å±•ç‚¹
    â†“
Step 2: æ‰©å±• spec.mdï¼ˆæ·»åŠ  User Storyï¼‰
    â†“ âš ï¸ äººå·¥æ£€æŸ¥ç‚¹
Step 3: æ‰©å±• plan.mdï¼ˆæ·»åŠ  API/DDLï¼‰
    â†“ âš ï¸ äººå·¥æ£€æŸ¥ç‚¹
Step 4: æ›´æ–° tasks.mdï¼ˆæ·»åŠ æ‰©å±•ä»»åŠ¡ï¼‰
    â†“ âš ï¸ äººå·¥æ£€æŸ¥ç‚¹
Step 5: æ‰§è¡Œå®ç°
```

---

## Step 1: åˆ†ææ‰©å±•ç‚¹

### ç›®æ ‡

ç†è§£ç°æœ‰åŠŸèƒ½ï¼Œç¡®å®šæ‰©å±•ä½ç½®å’Œå½±å“èŒƒå›´ã€‚

### è¾“å…¥

- æ‰©å±•éœ€æ±‚æè¿°
- ç°æœ‰ `specs/{feature}/` æ–‡æ¡£

### æ´»åŠ¨

1. **é˜…è¯»ç°æœ‰æ–‡æ¡£**
   - `spec.md` - ç†è§£å·²æœ‰åŠŸèƒ½èŒƒå›´
   - `plan.md` - ç†è§£æŠ€æœ¯æ¶æ„
   - `tasks.md` - æŸ¥çœ‹å®ç°å†å²

2. **ç¡®å®šæ‰©å±•ç‚¹**
   - æ–°å¢å“ªäº› User Stories
   - æ–°å¢å“ªäº› API æ¥å£
   - æ–°å¢å“ªäº›æ•°æ®å­—æ®µ
   - ä¸ç°æœ‰åŠŸèƒ½çš„å…³è”

3. **è¯„ä¼°å½±å“**
   - æ˜¯å¦å…¼å®¹ç°æœ‰æ¥å£
   - æ˜¯å¦éœ€è¦æ•°æ®è¿ç§»
   - æ˜¯å¦å½±å“ç°æœ‰åŠŸèƒ½

### è¾“å‡º

- æ‰©å±•ç‚¹æ¸…å•
- å½±å“è¯„ä¼°æŠ¥å‘Š

### æ£€æŸ¥æ¸…å•

- [ ] å·²ç†è§£ç°æœ‰åŠŸèƒ½
- [ ] æ‰©å±•ç‚¹æ˜ç¡®
- [ ] å…¼å®¹æ€§å·²è¯„ä¼°
- [ ] ä¸æ¶‰åŠç ´åæ€§å˜æ›´

---

## Step 2: æ‰©å±• spec.md

### ç›®æ ‡

åœ¨ç°æœ‰éœ€æ±‚æ–‡æ¡£ä¸­æ·»åŠ æ–°çš„ User Stories å’ŒéªŒæ”¶æ ‡å‡†ã€‚

### è¾“å…¥

- Step 1 çš„æ‰©å±•ç‚¹æ¸…å•
- ç°æœ‰ `specs/{feature}/spec.md`

### æ´»åŠ¨

åœ¨ `spec.md` ä¸­æ·»åŠ æ–°å†…å®¹ï¼ˆä½¿ç”¨ ğŸ†• æ ‡è®°ï¼‰ï¼š

```markdown
## User Stories

### Story 1: åŸºç¡€ç™»å½• (P1) âœ… å·²å®ç°
AS a ç”¨æˆ·
I WANT ä½¿ç”¨è´¦å·å¯†ç ç™»å½•
SO THAT è®¿é—®ç³»ç»ŸåŠŸèƒ½

### Story 2: ç¬¬ä¸‰æ–¹ç™»å½• (P2) ğŸ†• æ‰©å±•
AS a ç”¨æˆ·
I WANT ä½¿ç”¨å¾®ä¿¡/æ”¯ä»˜å®ç™»å½•
SO THAT ç™»å½•æ›´ä¾¿æ·

## Acceptance Criteria

### AC-1.x: åŸºç¡€ç™»å½• âœ… å·²å®ç°
...

### AC-2.1: å¾®ä¿¡ç™»å½• ğŸ†• æ‰©å±•
WHEN ç”¨æˆ·ç‚¹å‡»å¾®ä¿¡ç™»å½•æŒ‰é’®
THE SYSTEM SHALL è·³è½¬åˆ°å¾®ä¿¡æˆæƒé¡µé¢
```

### è¾“å‡º

- æ›´æ–°åçš„ `specs/{feature}/spec.md`

### æ£€æŸ¥æ¸…å•

- [ ] æ–° User Stories å®Œæ•´
- [ ] ä½¿ç”¨ EARS è¡¨ç¤ºæ³•
- [ ] æ ‡è®° ğŸ†• æ‰©å±•å†…å®¹
- [ ] ä¿æŒä¸ç°æœ‰å†…å®¹ä¸€è‡´

### âš ï¸ äººå·¥æ£€æŸ¥ç‚¹

> **AI MUST STOP HERE**

å®Œæˆ Step 2 åï¼š
1. å‘ç”¨æˆ·å±•ç¤ºæ›´æ–°çš„ `spec.md`
2. ç­‰å¾…ç”¨æˆ·å®¡æ‰¹
3. **ç¦æ­¢è‡ªåŠ¨ç»§ç»­**

---

## Step 3: æ‰©å±• plan.md

### ç›®æ ‡

åœ¨ç°æœ‰è®¾è®¡æ–‡æ¡£ä¸­æ·»åŠ æ–°çš„æŠ€æœ¯è®¾è®¡ã€‚

### è¾“å…¥

- Step 2 æ›´æ–°çš„éœ€æ±‚
- ç°æœ‰ `specs/{feature}/plan.md`

### æ´»åŠ¨

1. **æ‰©å±• API å®šä¹‰**ï¼ˆå¦‚éœ€è¦ï¼‰

```api
// åœ¨ç°æœ‰ .api æ–‡ä»¶ä¸­æ·»åŠ æ–°æ¥å£
@server(
    prefix: /api/v1/user
    group: auth
)
service project-api {
    // ğŸ†• æ‰©å±•ï¼šå¾®ä¿¡ç™»å½•
    @handler WechatLogin
    post /login/wechat (WechatLoginReq) returns (LoginResp)
}

type (
    // ğŸ†• æ‰©å±•ï¼šå¾®ä¿¡ç™»å½•è¯·æ±‚
    WechatLoginReq {
        Code string `json:"code" validate:"required"`
    }
)
```

2. **æ‰©å±• DDL å®šä¹‰**ï¼ˆå¦‚éœ€è¦ï¼‰

```sql
-- åœ¨ç°æœ‰è¡¨ä¸­æ·»åŠ å­—æ®µ
ALTER TABLE `user` ADD COLUMN `wechat_openid` varchar(64) DEFAULT NULL COMMENT 'å¾®ä¿¡OpenID';
ALTER TABLE `user` ADD COLUMN `alipay_userid` varchar(64) DEFAULT NULL COMMENT 'æ”¯ä»˜å®UserID';
```

3. **æ›´æ–°æ–‡ä»¶æ¸…å•**

```markdown
## æ‰©å±•æ–‡ä»¶æ¸…å• ğŸ†•

| åºå· | æ–‡ä»¶ | æ“ä½œ | è¯´æ˜ |
|------|------|------|------|
| 1 | `api/doc/user/auth.api` | ä¿®æ”¹ | æ·»åŠ å¾®ä¿¡ç™»å½•æ¥å£ |
| 2 | `migrations/user/001_add_oauth.sql` | æ–°å¢ | OAuth å­—æ®µ |
| 3 | `api/internal/logic/auth/wechat_login_logic.go` | æ–°å¢ | å¾®ä¿¡ç™»å½•é€»è¾‘ |
```

### è¾“å‡º

- æ›´æ–°åçš„ `specs/{feature}/plan.md`
- æ–°çš„/ä¿®æ”¹çš„ `.api` æ–‡ä»¶
- æ–°çš„/ä¿®æ”¹çš„ `.sql` æ–‡ä»¶

### æ£€æŸ¥æ¸…å•

- [ ] æ–°æ¥å£è®¾è®¡å®Œæ•´
- [ ] DDL å˜æ›´æ˜ç¡®
- [ ] å‘åå…¼å®¹
- [ ] æ–‡ä»¶æ¸…å•æ›´æ–°

### âš ï¸ äººå·¥æ£€æŸ¥ç‚¹

> **AI MUST STOP HERE**

å®Œæˆ Step 3 åï¼š
1. å‘ç”¨æˆ·å±•ç¤ºæ›´æ–°çš„ `plan.md` å’Œç›¸å…³æ–‡ä»¶
2. ç­‰å¾…ç”¨æˆ·å®¡æ‰¹
3. **ç¦æ­¢è‡ªåŠ¨ç»§ç»­**

---

## Step 4: æ›´æ–° tasks.md

### ç›®æ ‡

æ·»åŠ æ‰©å±•ä»»åŠ¡åˆ°ä»»åŠ¡æ¸…å•ã€‚

### è¾“å…¥

- Step 3 çš„æŠ€æœ¯è®¾è®¡
- ç°æœ‰ `specs/{feature}/tasks.md`

### æ´»åŠ¨

åœ¨ `tasks.md` ä¸­æ·»åŠ æ‰©å±•ä»»åŠ¡ç»„ï¼š

```markdown
---

## æ‰©å±•ä»»åŠ¡ç»„ï¼šç¬¬ä¸‰æ–¹ç™»å½• ğŸ†•

### Task E1: æ·»åŠ  OAuth æ•°æ®åº“å­—æ®µ

**Status**: Not Started
**Depends on**: -
**Estimated Lines**: 10
**Type**: â• Extension

**Files**:
- `migrations/user/001_add_oauth.sql`

**Acceptance Criteria**:
- [ ] DDL æ–‡ä»¶åˆ›å»º
- [ ] è¿ç§»æ‰§è¡ŒæˆåŠŸ

---

### Task E2: å®ç°å¾®ä¿¡ç™»å½•é€»è¾‘

**Status**: Not Started
**Depends on**: Task E1
**Estimated Lines**: 40
**Type**: â• Extension

**Files**:
- `api/internal/logic/auth/wechat_login_logic.go`
- `pkg/oauth/wechat.go`

**Acceptance Criteria**:
- [ ] å¾®ä¿¡æˆæƒå¯¹æ¥
- [ ] ç”¨æˆ·åˆ›å»º/ç»‘å®šé€»è¾‘
- [ ] æµ‹è¯•é€šè¿‡
```

### è¾“å‡º

- æ›´æ–°åçš„ `specs/{feature}/tasks.md`

### æ£€æŸ¥æ¸…å•

- [ ] æ‰©å±•ä»»åŠ¡ç»„æ ‡è®°æ¸…æ™°
- [ ] ä¾èµ–å…³ç³»æ­£ç¡®
- [ ] æ¯ä¸ªä»»åŠ¡ < 50 è¡Œ

### âš ï¸ äººå·¥æ£€æŸ¥ç‚¹

> **AI MUST STOP HERE**

å®Œæˆ Step 4 åï¼š
1. å‘ç”¨æˆ·å±•ç¤ºæ›´æ–°çš„ `tasks.md`
2. ç­‰å¾…ç”¨æˆ·å®¡æ‰¹
3. **ç¦æ­¢è‡ªåŠ¨ç»§ç»­**

---

## Step 5: æ‰§è¡Œå®ç°

### ç›®æ ‡

æŒ‰ç…§æ‰©å±•ä»»åŠ¡æ¸…å•å®ç°åŠŸèƒ½ã€‚

### æ´»åŠ¨

1. **æ‰§è¡Œæ•°æ®åº“è¿ç§»**
   ```bash
   # æ‰§è¡Œ DDL å˜æ›´
   mysql -u root -p database < migrations/user/001_add_oauth.sql
   ```

2. **é‡æ–°ç”Ÿæˆä»£ç æ¡†æ¶**
   ```bash
   # åœ¨ api.api ä¸­ import ä¿®æ”¹åçš„ auth.api
   goctl api go -api api/doc/api.api -dir api/ --style=go_zero --type-group
   ```

3. **å®ç°æ‰©å±•é€»è¾‘**
   - æŒ‰ä»»åŠ¡é¡ºåºæ‰§è¡Œ
   - æ¯ä¸ªä»»åŠ¡å®Œæˆåæ›´æ–°çŠ¶æ€

4. **ç¼–å†™æµ‹è¯•**
   - è¦†ç›–æ–°å¢åŠŸèƒ½
   - ç¡®ä¿ä¸å½±å“ç°æœ‰åŠŸèƒ½

5. **æ›´æ–°ç‰ˆæœ¬å†å²**
   ```markdown
   | 2.0 | 2026-01-02 | xxx | æ·»åŠ ç¬¬ä¸‰æ–¹ç™»å½•ï¼ˆå¾®ä¿¡/æ”¯ä»˜å®ï¼‰ |
   ```

---

## å·¥å…·è§¦å‘æ–¹å¼

| å·¥å…· | å‘½ä»¤ | è¯´æ˜ |
|------|------|------|
| **Cursor** | `/speckit-scenario-extend` | æ‰©å±•æµç¨‹ |
| **Claude Code** | `/speckit.scenario.extend` | å‘½ä»¤æ¨¡å¼ |
| **æ‰‹åŠ¨** | æŸ¥é˜…æœ¬æ–‡æ¡£ | æ—  AI å·¥å…·æ—¶ |

---

## æ‰©å±•æœ€ä½³å®è·µ

### 1. ä¿æŒå‘åå…¼å®¹

- æ–°å¢å­—æ®µè®¾ç½®é»˜è®¤å€¼
- ä¿ç•™æ—§æ¥å£ï¼Œæ·»åŠ æ–°æ¥å£
- æ•°æ®è¿ç§»è„šæœ¬å¯å›æ»š

### 2. æ¸è¿›å¼æ‰©å±•

- å…ˆå®Œæˆæ–‡æ¡£ï¼Œå†å†™ä»£ç 
- æ¯ä¸ªæ­¥éª¤éƒ½æœ‰å®¡æ‰¹ç‚¹
- åˆ†æ‰¹å‘å¸ƒï¼Œé™ä½é£é™©

### 3. æ¸…æ™°çš„æ ‡è®°

- ä½¿ç”¨ ğŸ†• æ ‡è®°æ–°å¢å†…å®¹
- ä½¿ç”¨ âœ… æ ‡è®°å·²å®ç°
- ä½¿ç”¨ç‰ˆæœ¬å·åŒºåˆ†æ‰¹æ¬¡

---

## ä¸å…¶ä»–åœºæ™¯çš„è¾¹ç•Œ

### ä½•æ—¶é™çº§åˆ°åœºæ™¯äºŒï¼ˆå°æ”¹åŠ¨ï¼‰ï¼Ÿ

- åªæ˜¯å‚æ•°è°ƒæ•´
- ä¸æ¶‰åŠæ–°æ¥å£
- ä¸æ¶‰åŠæ•°æ®åº“å˜æ›´

### ä½•æ—¶å‡çº§åˆ°åœºæ™¯å››ï¼ˆé‡æ„ï¼‰ï¼Ÿ

- éœ€è¦ä¿®æ”¹ç°æœ‰æ¥å£ç­¾å
- éœ€è¦åˆ é™¤/åˆå¹¶å·²æœ‰åŠŸèƒ½
- æ¶‰åŠå¤§è§„æ¨¡æ¶æ„è°ƒæ•´

---

## å‚è€ƒæ–‡æ¡£

- [åœºæ™¯é€‰æ‹©å†³ç­–æ ‘](./README.md)
- [åœºæ™¯ä¸€ï¼šæ–°åŠŸèƒ½](./scenario-1-new.md)
- [åœºæ™¯äºŒï¼šå°æ”¹åŠ¨](./scenario-2-update.md)
- [åœºæ™¯å››ï¼šå¤§è§„æ¨¡é‡æ„](./scenario-4-refactor.md)
