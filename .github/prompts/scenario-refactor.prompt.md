# Scenario: Major Refactor Workflow

引导用户对已有功能进行大规模重构。

---

## 场景识别

当满足以下条件时使用此工作流：
- `specs/{feature}/` 目录已存在
- 涉及破坏性变更
- 需要数据迁移
- 需要版本化管理

---

## 工作流

按照 `.specify/workflows/scenario-4-refactor.md` 中的定义执行。

### Step 1: 审查现有文档

标记内容：
- ✅ 保留
- ⚠️ 修改
- ❌ 删除
- 🆕 新增

### Step 2: 创建 v2 目录

```
specs/{feature}/
├── v1/  (旧版本)
└── v2/  (新版本)
```

### Step 3: 重新设计 spec.md

包含变更概述和破坏性变更列表。

**⚠️ 停止等待确认**

### Step 4: 重新设计 plan.md

1. 版本号升级的 API
2. 数据库迁移脚本
3. 兼容层设计

**⚠️ 停止等待确认**

### Step 5: 创建迁移任务

1. migration.md - 迁移指南
2. tasks.md - 迁移任务组

**⚠️ 停止等待确认**

### Step 6: 执行迁移

1. 备份数据库
2. 按任务执行
3. 验证功能

---

## Important

- 必须保留旧版本文档
- 必须列出破坏性变更
- 必须准备回滚方案
